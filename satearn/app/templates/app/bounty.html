{% extends "app/navbar.html" %}

{% block main %}

<!--TODO: Add bounty image-->
<!--TODO: Pretty this up-->

<div class="text-center" id="bounty">
    <span>
        <h1>{{ bounty.title }} - {{ bounty.reward }} sats</h1>
        {% if is_me and bounty.status == bounty.NEW %}
        &nbsp;&nbsp;<button class="btn btn-outline-success" onclick="editbounty()">Edit Bounty</button>
        {% endif %}
    </span>

    {% if not is_me %}
    <a href="{% url 'accounts:profile' bounty.author.id %}"><h2>{{ bounty.author.username }}</h2></a>
    <br>
    {% endif %}
    <h3>{{ bounty.description }}</h3>

    <p>Reward: {{bounty.reward}} satoshis</p>
    <p>Due: {{bounty.due_date}}</p>

    {% if user.is_authenticated and not is_me and application_id < 0 %}
    <form method="post" action="{% url 'app:apply' bounty.id %}">
        {% csrf_token %}
        <input type="submit" class="btn btn-outline-success" value="Apply">
    </form>
    {% elif application_id > -1 %}
    <form method="post" action="{% url 'app:unapply' bounty.id application_id %}">
        {% csrf_token %}
        <input type="submit" class="btn btn-outline-danger" value="Unapply">
    </form>
    {% endif %}
</div>

{% if user.is_authenticated and is_me and bounty.status == bounty.NEW %}
<div class="text-center" id="bounty_edit" style="display: none;">
    <h1>Edit Bounty</h1>
    <form method="POST" action="{% url 'app:bounty' bounty.id %}">
        {% csrf_token %}
        {{ bounty_form.as_p }}
        <input type="submit" class="btn btn-outline-success" value="Save Changes" onclick="canceledit()">
        <input type="button" class="btn btn-outline-danger" value="Cancel" onclick="canceledit()">
    </form>
</div>
<div id="applications">
    <h3>Applicants</h3>
    <hr />
    <table class="table table-hover">
        <thead>
            <th scope="col">Applicant</th>
            <th scope="col">Application Date</th>
            <th scope="col"></th>
        </thead>
        <tbody>
            {% for application in applications %}
            <tr>
                <th><a href="{% url 'accounts:profile' application.applicant.id %}">{{ application.applicant.username }}</a></th>
                <td>{{ application.created_on }}</td>
                <td><button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#confirmModal" onclick="confirm('{{ application.applicant.username }}')">Select Applicant</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Confirm Applicant Selection</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="confirmationTxt">
          Select this applicant for this bounty?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
          <button type="button" class="btn btn-primary">Yes</button>
        </div>
      </div>
    </div>
</div>

<script>

    var myModal = document.getElementById('myModal');
    var myInput = document.getElementById('myInput');

    myModal.addEventListener('shown.bs.modal', function () {
        myInput.focus()
    });

    function editbounty(){
        document.getElementById("bounty").style.display = "none";
        document.getElementById("applications").style.display = "none";
        document.getElementById("bounty_edit").style.display = "block";
    }
    
    function canceledit(){
        document.getElementById("bounty").style.display = "block";
        document.getElementById("applications").style.display = "block";
        document.getElementById("bounty_edit").style.display = "none";
    }

    function confirm(applicant){
        document.getElementById("confirmationTxt").innerHTML = `Select ${applicant} for this bounty?`;
    }
</script>
{% endif %}

<!--TODO: Be able to choose an applicant and automatically change status-->
<!--TODO: Show "Are you sure?" modal when you select an applicant-->

{% endblock %}